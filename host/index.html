<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Host</title>

        <style>
            #btnGetCookie   {display:block; margin-bottom:20px;}
            #cookie-iframe  {border:0; height:0; width:0;}
        </style>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

        <script type="text/javascript">
            var postMessageOrigin = 'http://postmessage-iframe.com:40001',
                postMessageSender = 'http://postmessage-host.com:40000',
                postMessageTarget = 'http://postmessage-iframe.com:40001';

            function postMessage(data) {
                $('#cookie-iframe')[0].contentWindow.postMessage(data, postMessageTarget);
            }

            function receiveMessage (evt) {
                console.log('Host received message. Evaluating origin.', evt);

                //Verify that we allow receiving of messages from the origin.
                if (evt.origin !== postMessageOrigin) {
                    console.warn('Invalid origin! Not processing message!');
                    return;
                } else {
                    console.log('Valid origin. Proceeding with message digest.', evt);
                    console.log('Message data received:', evt.data);
                    $('div#log').append('<p>Cookie value: ' + evt.data.cookie + '</p>');
                }
            }

            $(function() {
                $('input#btnGetCookie').click(function () {
                    postMessage('sendCookie');
                });

                window.addEventListener('message', receiveMessage, false);
            });
        </script>
    </head>
    <body>
        <h2>Host</h2>
        <input type="button" id="btnGetCookie" value="Get Cookie" />
        <iframe id="cookie-iframe" src="http://postmessage-iframe.com:40001/index.html"></iframe>
        <div id="log"></div>
    </body>
</html>
